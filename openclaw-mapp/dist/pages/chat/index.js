"use strict";(wx["webpackJsonp"]=wx["webpackJsonp"]||[]).push([[947],{1995:function(e,n,t){var s,a,c=t(6368),o=t(5738),i=t(6693),r=t(9551),l=t(2363),u=t(7653),h=t(3279),d=t(8677),m=t(758),p=t(7593),f=t(4340),v=t.n(f),g=t(6056),x=t(6070),w=(s=(0,g.WQ)("chatStore"),s(a=(0,g.PA)(a=function(e){function n(){var e;(0,r.A)(this,n);for(var t=arguments.length,s=new Array(t),a=0;a<t;a++)s[a]=arguments[a];return e=(0,u.A)(this,n,[].concat(s)),(0,d.A)(e,"inputContent",""),(0,d.A)(e,"scrollViewRef",null),(0,d.A)(e,"handleInputChange",function(n){e.inputContent=n.detail.value}),(0,d.A)(e,"handleSend",(0,i.A)((0,o.A)().m(function n(){var t,s,a;return(0,o.A)().w(function(n){while(1)switch(n.p=n.n){case 0:if(t=e.props.chatStore,e.inputContent&&e.inputContent.trim()){n.n=1;break}return n.a(2);case 1:if(null!==t&&void 0!==t&&t.connected){n.n=2;break}return v().showToast({title:"\u672a\u8fde\u63a5\u5230\u670d\u52a1\u5668",icon:"none"}),n.a(2);case 2:return s=e.inputContent.trim(),e.inputContent="",e.forceUpdate(),n.p=3,n.n=4,t.sendMessage(s);case 4:e.scrollToBottom(),n.n=6;break;case 5:n.p=5,a=n.v,v().showToast({title:a.message||"\u53d1\u9001\u5931\u8d25",icon:"none"});case 6:return n.a(2)}},n,null,[[3,5]])}))),(0,d.A)(e,"scrollToBottom",function(){setTimeout(function(){var n=v().createSelectorQuery();n.select(".messages-container").boundingClientRect(),n.exec(function(n){var t;n[0]&&(null===(t=e.scrollViewRef)||void 0===t||t.scrollTo({top:n[0].height,duration:300}))})},100)}),(0,d.A)(e,"handleClearHistory",function(){var n=e.props.chatStore;v().showModal({title:"\u786e\u8ba4",content:"\u786e\u5b9a\u8981\u6e05\u7a7a\u804a\u5929\u8bb0\u5f55\u5417\uff1f",success:function(e){e.confirm&&(n.clearMessages(),v().showToast({title:"\u5df2\u6e05\u7a7a",icon:"success"}))}})}),(0,d.A)(e,"renderMessage",function(e){var n="user"===e.role,t="error"===e.status;return(0,x.jsx)(p.Ss,{className:"message-item ".concat(n?"user":"assistant"),children:(0,x.jsxs)(p.Ss,{className:"message-bubble",children:["sending"===e.status&&(0,x.jsx)(p.EY,{className:"message-status",children:"\u53d1\u9001\u4e2d..."}),t&&(0,x.jsx)(p.EY,{className:"message-status error",children:"\u53d1\u9001\u5931\u8d25"}),(0,x.jsx)(p.EY,{className:"message-content ".concat(t?"error":""),children:e.content}),(0,x.jsx)(p.EY,{className:"message-time",children:new Date(e.timestamp).toLocaleTimeString()})]})},e.id)}),e}return(0,h.A)(n,e),(0,l.A)(n,[{key:"componentDidMount",value:function(){this.checkConnection()}},{key:"componentDidShow",value:function(){this.scrollToBottom()}},{key:"checkConnection",value:function(){var e=this.props.chatStore;null!==e&&void 0!==e&&e.wsUrl?null!==e&&void 0!==e&&e.connected||this.tryConnect():v().showModal({title:"\u63d0\u793a",content:"\u60a8\u8fd8\u672a\u914d\u7f6e\u670d\u52a1\u5668\u5730\u5740\uff0c\u662f\u5426\u524d\u5f80\u8bbe\u7f6e\uff1f",success:function(e){e.confirm&&v().switchTab({url:"/pages/welcome/index"})}})}},{key:"tryConnect",value:function(){var e=(0,i.A)((0,o.A)().m(function e(){var n,t;return(0,o.A)().w(function(e){while(1)switch(e.p=e.n){case 0:return n=this.props.chatStore,e.p=1,e.n=2,n.connect();case 2:e.n=4;break;case 3:e.p=3,t=e.v,console.error("Auto-connect failed:",t);case 4:return e.a(2)}},e,this,[[1,3]])}));function n(){return e.apply(this,arguments)}return n}()},{key:"render",value:function(){var e,n,t=this,s=this.props.chatStore,a=s||{},c=a.messages,o=a.connected,i=a.connecting;return(0,x.jsxs)(p.Ss,{className:"chat-page",children:[(0,x.jsxs)(p.Ss,{className:"chat-header",children:[(0,x.jsx)(p.EY,{className:"header-title",children:"OpenClaw Chat"}),(0,x.jsxs)(p.Ss,{className:"header-actions",children:[(0,x.jsx)(p.Ss,{className:"status-badge ".concat(o?"connected":"disconnected"),children:(0,x.jsx)(p.EY,{className:"status-text",children:i?"\u8fde\u63a5\u4e2d...":o?"\u5df2\u8fde\u63a5":"\u672a\u8fde\u63a5"})}),(0,x.jsx)(p.$n,{className:"clear-btn",size:"mini",onClick:this.handleClearHistory,children:"\u6e05\u7a7a"})]})]}),(0,x.jsx)(p.BM,{className:"messages-container",scrollY:!0,scrollIntoView:"bottom",ref:function(e){t.scrollViewRef=e},children:(0,x.jsxs)(p.Ss,{className:"messages-list",children:[c&&c.length>0?c.map(function(e){return t.renderMessage(e)}):(0,x.jsxs)(p.Ss,{className:"empty-state",children:[(0,x.jsx)(p.EY,{className:"empty-text",children:"\u6682\u65e0\u6d88\u606f"}),(0,x.jsx)(p.EY,{className:"empty-hint",children:"\u8f93\u5165\u6d88\u606f\u5f00\u59cb\u804a\u5929"})]}),(0,x.jsx)(p.Ss,{id:"bottom"})]})}),(0,x.jsxs)(p.Ss,{className:"input-area",children:[(0,x.jsx)(p.pd,{className:"message-input",type:"text",placeholder:"\u8f93\u5165\u6d88\u606f...",value:this.inputContent,onInput:this.handleInputChange,onConfirm:this.handleSend,confirmType:"send"}),(0,x.jsx)(p.$n,{className:"send-btn ".concat(null!==(e=this.inputContent)&&void 0!==e&&e.trim()&&o?"":"disabled"),size:"mini",onClick:this.handleSend,disabled:!(null!==(n=this.inputContent)&&void 0!==n&&n.trim())||!o,children:"\u53d1\u9001"})]})]})}}])}(m.Component))||a)||a),C=w,b={},j=(0,c.eU)(C,"pages/chat/index",{root:{cn:[]}},b||{});C&&C.behaviors&&(j.behaviors=(j.behaviors||[]).concat(C.behaviors));Page(j)}},function(e){var n=function(n){return e(e.s=n)};e.O(0,[907,96],function(){return n(1995)});e.O()}]);